<script src="../dist/file-p2p-engine.min.js"></script>
<h3>download info:</h3>
<p id="url"></p>
<p id="mime"></p>
<p id="size"></p>
<p id="progress"></p>
<p id="speed"></p>
<p id="p2p"></p>
<script>

    var url = 'https://webtorrent.io/torrents/Sintel/Sintel.mp4';


    var downloader = new P2PEngineFile(url, {
        // p2pEnabled: false,
        logLevel: 'debug',
        // concurrentLoadNum: 1,
        // pieceLength: 1024*1024,
        // memoryCacheLimit: {                            // p2p缓存的最大数据量（分为PC和移动端）
        //     pc: 1024*10,                      // PC端缓存大小
        //     mobile: 1024*1024*256,                   // 移动端缓存大小
        // },
        // announce: "https://player.yapi.xyz/v1",

        // 测试环境
        announce: "https://tracker.p2pengine.net:7067/v1",
        // wsSignalerAddr: 'wss://signal.p2pengine.net:8089',
    })
        .on('metadata', function (source) {
            document.querySelector('#url').innerText = `Url: ${source.getUrl()}`;
            document.querySelector('#mime').innerText = `Mime: ${source.getMime()}`;
            document.querySelector('#size').innerText = `Size: ${source.getFileLength()}`;
        })
        .on('finished', function (file) {
            // console.warn('download finished ' + file.sourceInfo.getUrl());
            document.querySelector('#progress').innerText = `Download finished`
            // file.save('test1.mp4')
        })
        .on('progress', ratio => {
            // console.warn('download progress ' + ratio);
            document.querySelector('#progress').innerText = `Progress: ${ratio.toFixed(2)}%`
        })
        .on('speed', speed => {
            console.warn('download speed ' + speed);
            document.querySelector('#speed').innerText = `Speed: ${Math.round(speed/1000)}KB/s`
        })
        .on('failed', function (e) {
            // fallback
            const a = document.createElement('a');
            a.download = "origin.mp4";
            a.href = url;
            document.body.appendChild(a);
            a.click();
            a.remove();
        })
        .on('stats', function (stats) {
            var total = stats.totalHTTPDownloaded + stats.totalP2PDownloaded;
            document.querySelector('#p2p').innerText = `p2p ratio: ${Math.round(stats.totalP2PDownloaded/total*100)}%   saved traffic: ${Math.round(stats.totalP2PDownloaded)}KB upload: ${Math.round(stats.totalP2PUploaded)}KB`;
        })

    downloader.start();

</script>
